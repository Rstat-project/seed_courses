---
title: "Undergraduate 1-2 practice"
author: "Student's name"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)

## 預先安裝/載入tidyverse
if(!require(tidyverse)){install.packages("tidyverse");library(tidyverse)}else{library(tidyverse)}

## 預先安裝/載入babynames
if(!require(babynames)){install.packages("babynames");library(babynames)}else{library(babynames)}
```


## 示範及作業說明

本節示範檔案包含[Level 1: Data Skills](https://psyteachr.github.io/data-skills/)(以下簡稱level 1)的單元4~8。其他資料視覺化學習素材，推薦參考[Data visualisation using R, for researchers who don’t use R](https://psyteachr.github.io/introdataviz/)。

學習重點有常用的六種資料整頓`dplyr`(整合於`tidyverse`)函式：`select()`,`filter()`,`mutate()`,`arrange()`,`group_by()`,`summarise()`，以及柱狀圖/箱形圖為範例的ggplot2視覺化語法。


## 演練資料集來源

- Positive Psychology data from [Woodworth et al. (2018)](https://openpsychologydata.metajnl.com/articles/10.5334/jopd.35/)

- `babynames` 參考Level 1 單元5


## 匯入資料

```{r data-import}
## 見下一節“預覽資料”說明

## 參考 https://psyteachr.github.io/quant-fun-v2/data-wrangling-1.html#dw1-a1
library(babynames) ## 匯入已建資料集babynames
## ?babynames  ##查詢babynames資訊


## 下載/匯入Woodworth et al. (2018)資料集
## 參考https://psyteachr.github.io/quant-fun-v2/starting-with-data.html#ld-a1
woodworth2018_dat <- read_csv("https://psyteachr.github.io/quant-fun-v2/ahi-cesd.csv")

woodworth2018_pinfo <- read_csv("https://psyteachr.github.io/quant-fun-v2/participant-info.csv")
```

- 匯入既存套件資料


- 匯入外部檔案資料

  - 由本機儲存檔案匯入
  - 由公開網站匯入


##  本節演練資料介紹

- babynames

variable|type             |description
--------|-----------------|--------------------------------------------
  year  |double (numeric) |year of birth
  sex 	|character 	      |recorded sex of baby (F = female, M = male)
  name 	|character 	      |forename given to baby
  n 	  |integer 	        |number of babies given that name
  prop 	|double (numeric) |	proportion of all babies of that sex

- Positive Psychology data

下載[資料編碼說明pdf](https://figshare.com/articles/dataset/A_randomized_placebo-controlled_trial_of_positive_psychology_interventions_in_Australia/1577563/1?file=10386963)  


## 資料整頓(Data wrangling)


### 合併資料(`_join`)

示範合併量表資料("ahi-cesd.csv")與參與者資訊("participant-info.csv")：

```{r positive-join, echo=TRUE}
all_dat <- inner_join(x = woodworth2018_dat, # the first table you want to join
                      y = woodworth2018_pinfo, # the second table you want to join
                      by = c("id", "intervention")) # columns the two tables have in common
```


### 選擇欄位變項(`select`)

- 示範選擇babynames data要分析的欄位

```{r babynames-select, echo=TRUE}
select(.data = babynames, # the object you want to select variables from
       year, sex, name, prop) # the variables you want to select
```


### 排序資料(`arrange`)

- 配合預覽函式(`head()`,`tail()`,...)，`arrange()`顯示重要變項的部分資料

- 示範排序babynames data

```{r babynames-arrange, echo=TRUE}
arrange(.data = babynames, # the data you want to sort
        name) # the variable you want to sort by

arrange(babynames,desc(year)) 

arrange(babynames, desc(year), desc(sex), desc(prop)) 
```


### 篩選資料列(`filter`)

- 根據分析條件，保留需要的資料

- 示範篩選babynames data

```{r babynames-filter, echo=TRUE}
filter(.data = babynames, year > 2000)

filter(babynames, name == "Mary")
## filter(babynames, name!="Mary") 
filter(babynames, name %in% c("Mary","Elizabeth","Victoria"))
## filter(babynames, !(name %in% c("Mary","Elizabeth","Victoria")))
```

### 建立新資料欄位(`mutate`)

- 依分析條件從已存變項建立新變項

```{r babynames-mutate, echo=TRUE}
new_dat <- mutate(.data = babynames, # the tibble you want to add a column to
                  decade = floor(year/10) *10) # new column name = what you want it to contain
head(new_dat)
```

### 資料分組(`group_by`)

- 進行分組分析前，指定定義分組的變項

```{r babynames-group, echo=TRUE}
group_dat <- group_by(.data = babynames, # the data you want to group
                      name) # the variable you want to group by
```


### 資料分組統計(`summarise`)

- 要處理分組統計，要先用`group_by`定義分組用變項

```{r babynames-summarise, echo=TRUE}
summarise(.data = group_dat, 
          total = sum(n)) 
```

## 資料視覺化

- 使用適合的視覺化方法能概覽資料

```{r babynames-visual, echo=TRUE}
dat <- babynames %>% 
  filter(name %in% c("Emily","Kathleen","Alexandra","Beverly"), sex=="F")

ggplot(data = dat,aes(x = year,y = prop, colour=name))+
  geom_line()  
```

> 折線圖透露了什麼訊息？


## 演練作業

1. 每個演練問題需要完成程式碼才能知道如何回答。

2. **根據chunk內的提示修改或編寫程式碼**

3. 使用合併的positive psychology data回答以下問題

### 資料整頓

- 選擇Positive Psychology data要分析的欄位，包括~ ahiTotal, cesdTotal, sex, age, educ, income, occasion,elapsed.days


```{r positive-data-select, echo=TRUE}
## 編輯程式碼，存入summarydata 
```


- 資料排序

```{r positive-arrange, echo=TRUE}
## 編輯程式碼，存入ahi_asc 與ahi_dsc
```

> "ahiTotal"變項最高分與最低分分別是多少？

- 篩選資料

```{r positive-filter, echo=TRUE}
## 編輯程式碼，存入自訂名稱的物件 
```

> 65歲以上的受測者有多少人？

- 新建變項與分組統計

```{r positive-summarise, echo=TRUE}
## 編輯程式碼，存入自訂名稱的物件 
```

> 以幸福感評分74分區別兩組受測者，統計兩組受測者的人數與cesd評分中位數？




### positive psychology data柱狀圖

- 參考Level 1單元7，完成能回答以下問題的柱狀圖

```{r positive-data-barplot}
## 編輯程式碼，繪製柱狀圖 
```

(根據上圖，在以下問題後面填寫你的答案)

> 參與者性別最多的是？


### positive psychology data箱形圖/小提琴圖


- 參考Level 1單元7，完成能回答以下問題的箱形圖/小提琴圖

```{r positive-data-baxplot}
## 編輯程式碼，繪製箱形圖/小提琴圖
```

(根據上圖，在以下問題後面填寫你的答案)

> 收入多少的參與者有最高的幸福感中位數？


> 收入多少的參與者有最低的幸福感中位數？


> 有多少參與者的收入被判定為極端值？

